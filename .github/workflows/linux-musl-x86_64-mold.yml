name: linux-muls-x86_64-mold self-contained

on:
  workflow_dispatch:

jobs:
  testing:

    runs-on: ubuntu-latest

    strategy:
      fail-fast: false
      matrix:
        version: [3.21, 3.20, 3.19, 3.18, 3.17, 3.16, 3.15]
 
    steps:
      - run: curl -LO https://github.com/leleliu008/test/releases/download/2023.10.08/mold-2.34.1-linux-glibc-any-x86_64.release.tar.xz
      - run: tar xf *.tar.xz --strip-components=1

      - run: |
          cat > run.sh <<EOF
          set -ex
          bin/mold --help
          bin/mold --version
          EOF

      - run: docker run -v $PWD:/root -w /root --name alpine alpine:${{ matrix.version }} sh run.sh
